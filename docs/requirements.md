# 项目需求文档（当前版本）

## 目标

1. 保留照片处理能力（布局、水印、白边、阴影、比例、质量等）。
1. 移除 CLI 与配置落盘，作为 GUI 的无状态处理引擎使用。
1. 支持文件列表输入与可选输出目录。
1. 日志仅用于运行期诊断；库默认正常退出自动清理，GUI 入口可按需保留日志用于问题定位。

## 功能需求

1. 输入形式
1. 支持传入文件列表
1. 不依赖固定 `input/` 目录
1. 支持单张与多张图片处理

2. 输出形式
1. 默认输出到“原图同目录”
1. 支持为多张图片指定统一输出目录
1. 支持单独输出映射（每张图指定输出路径）
1. 重名策略为默认覆盖

3. 处理能力
1. 支持现有全部布局类型
1. 支持白边、阴影、按原比例填充、等效焦距
1. 保留 EXIF（原图存在时）
1. 输出质量可控

4. 错误与日志
1. 处理失败需返回错误列表
1. 允许传入进度与错误回调
1. 日志为临时文件，正常退出自动清理
1. 异常退出时，下一次启动清理旧日志（默认保留 1 天）

5. 预览模式
1. 支持预览模式输出到临时文件
1. 预览支持指定最大边与质量
1. 预览输出不保留 EXIF

## 非功能需求

1. 无状态：不写入配置文件，不维护工作区结构
1. 可被 GUI 调用并在 UI 中进度可视化
1. 批量处理稳定
1. macOS `.app` 需可复现打包，且在 Tk 不兼容场景提供无风险回退（优先 app 内嵌 WebView）

## 对外接口（已实现）

1. 处理入口：`engine.process_images(...)`
1. 布局列表：`engine.get_layout_specs()`
1. 临时日志：`logging_setup.setup_temp_logging()`
1. 接口约定文档：`docs/api.md`
1. 配置表单支持：`engine.get_config_spec()`
